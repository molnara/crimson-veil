CRIMSON VEIL - FEATURE ROADMAP
================================

AI MODEL GUIDE
--------------
[Sonnet] = Standard implementation work (45-55 sessions/week capacity)
[Opus] = Complex architecture, code reviews, multi-system refactoring (3-4 sessions/week capacity)

CURRENT SPRINT: "Atmosphere & Audio" (v0.5.0 - 7-10 days) - Planned 2025-12-11
----------------------------------------------------------
Sprint Goal: Implement professional-quality sound system and ambient music using AI generation
Budget: $34 ($20 SFX Engine + $14 Mubert)
Timeline: 12-15 sessions (~24-30% capacity)

DESIGN DECISIONS (LOCKED IN):
Ã¢Å“â€¦ Music Style: Pure Ambient Drone (minimal, atmospheric, non-intrusive)
Ã¢Å“â€¦ Footstep Complexity: Biome-aware (4 surface types: grass, stone, sand, snow)
Ã¢Å“â€¦ Volume Philosophy: Hybrid (realistic ambient, exaggerated actions)
Ã¢Å“â€¦ Music Variety: Day/Night Variation (2 tracks total)

PRIORITY 1 - Core Sound System (Foundation) [5 sessions]
[X] Audio Manager Architecture [Sonnet] - Singleton with sound pooling, volume controls, pitch variation (COMPLETE 2025-12-11)
[X] AI Sound Generation & Import [Sonnet] - Generated 48 audio files (40 SFX + 8 music) via SFX Engine + Mubert (COMPLETE 2025-12-12)
[ ] SFX Integration - Core Actions [Sonnet] - Wire harvesting, building, movement, UI sounds

PRIORITY 2 - Music & Ambient System (Atmosphere) [5-6 sessions]
[ ] Music Manager & AI Music Generation [Sonnet] - Day/night ambient tracks via Mubert, crossfade system
[ ] Ambient Environmental Sounds [Sonnet] - Wind, ocean, wildlife layers (8 ambient loops)
[ ] UI & Feedback Sounds [Sonnet] - Crafting, health/hunger warnings, settings clicks

PRIORITY 3 - Polish & Refinement (Optional) [2-4 sessions]
[ ] Settings Menu - Audio Controls [Sonnet] - Volume sliders, mute toggles, test buttons
[ ] Sound Variation System [Sonnet] - Pitch/volume randomization, multiple footstep variants
[ ] Audio Balance Pass [Sonnet] - Test and adjust all volume levels across scenarios
[ ] Controller Rumble [Sonnet] - Haptic feedback for harvesting, building, tree falling (OPTIONAL)

AUDIO FILE MANIFEST (48 files total - ALL GENERATED):
- 40 SFX files (harvesting: 6, movement: 12, building: 3, UI: 9, container: 2, ambient: 8)
- 8 Music tracks (4 day ambient, 4 night ambient - 2 min each, WAV format)
- Tools used: SFX Engine ($8/month) + Mubert Creator ($14/month)
- Actual budget: $22 (under $34 target by $12)


NEXT UP (After v0.5.0)
----------------------
[ ] Workbench system [Sonnet] - Craftable building block, proximity detection, recipe gating
[ ] Inventory organization [Sonnet] - Sort/Quick-stack buttons, container animations
[ ] Save/load system [Opus] - Persistent world state (HIGH PRIORITY, complex serialization)
[ ] Combat system [Opus] - Basic enemy encounters with simple weapons (new system)
[ ] Advanced building [Sonnet] - Walls, roofs, furniture for proper base construction


BACKLOG (Prioritized)
---------------------
HIGH PRIORITY:
[ ] Save/load system [Opus] - Persistent world state and player progress (complex serialization)
[ ] Boss progression system [Opus] - Valheim-style boss encounters that gate biome access (new major system)
[ ] Workbench & Advanced Crafting [Sonnet] - DEFERRED FROM v0.5.0 - Workbench placement, proximity, recipes
[ ] Inventory Organization [Sonnet] - DEFERRED FROM v0.5.0 - Sort, quick-stack, drag-and-drop, animations
[ ] Advanced building [Sonnet] - Walls, roofs, furniture for proper base construction
[ ] Tool tiers [Sonnet] - Stone Ã¢â€ â€™ Iron Ã¢â€ â€™ Steel progression path
[ ] Durability system [Sonnet] - Tools degrade with use (creates resource sink)

MEDIUM PRIORITY:
[ ] Unique landmarks [Opus] - Procedurally placed points of interest (new generation system)
[ ] Animal AI improvements [Sonnet] - More realistic critter behaviors (feeding, fleeing, nesting)
[ ] Weather system [Sonnet] - Rain, snow, storms that affect gameplay
[ ] Farming system [Sonnet] - Plant crops, tend gardens for renewable food
[ ] NPC traders [Opus] - Buy/sell resources, discover rare items (new AI system)
[ ] Character customization [Sonnet] - Appearance options for player model
[ ] Controller UI navigation [Sonnet] - D-Pad navigation through inventory/crafting menus with visual focus

LOW PRIORITY:
[ ] Performance stats UI [Sonnet] - Display FPS, CPU, GPU, and memory usage in upper right corner
[ ] Custom skybox [Sonnet] - Replace ProceduralSkyMaterial with custom texture/cubemap
[ ] Snow covered trees in snow biome [Sonnet] - Visual enhancement for winter atmosphere
[ ] Multi-material terrain rendering [Sonnet] - Replace vertex color tinting (see chunk.gd:231)
[ ] Seasonal changes [Opus] - Visual and gameplay shifts throughout the year (complex system)
[ ] Fishing system [Sonnet] - Coastal/river fishing for food variety
[ ] Mounts/vehicles [Opus] - Faster travel options (new physics/control system)


SOMEDAY/MAYBE (Ideas to explore)
---------------------------------
- Multiplayer co-op [Opus] - Shared world building with friends (major architecture change)
- Magic/enchanting system [Opus] - Mystical progression path (new system)
- Underground/cave generation [Opus] - Deeper exploration with mining (major world gen change)
- Pet system [Sonnet] - Tamed critters that follow and help
- Treasure hunting [Sonnet] - Buried loot and rare discoveries
- Photography mode [Sonnet] - Capture and share scenic moments
- Container networks [Opus] - Auto-sorting/piping systems (complex logic)
- Named containers [Sonnet] - Label chests for organization
- Container security [Sonnet] - Locks or ownership system
- Dynamic soundtracks [Sonnet] - Music that responds to gameplay intensity
- Voice acting [Opus] - NPC dialogue, ambient storytelling


COMPLETED (Recent)
------------------
v0.4.0 RELEASE (December 12, 2025) - "Storage & Organization"
Sprint Completion: 11/15 tasks (73%) - Priorities 1 & 2 fully complete
Commit: d53049d

[X] Container UI [Sonnet] - Dual-panel interface with click/shift-click transfers (Phase 2 COMPLETE)
[X] UI state management [Sonnet] - Suppression/restoration when container opens/closes
[X] B button container close [Sonnet] - Controller quick exit
[X] Scene-based container UI [Sonnet] - container_ui.tscn for easier visual editing
[X] Container placement system [Sonnet] - Chests placeable as building blocks (10 wood cost)
[X] Container interaction [Sonnet] - E key or A button opens chest within 3m, context-sensitive A button
[X] Container highlighting [Sonnet] - Green outline when looking at chest (Layer 3 collision)
[X] Container removal warning [Sonnet] - Dialog confirms removal when chest has items
[X] Independent container inventories [Sonnet] - Each chest has own 32-slot Inventory instance
[X] Low-poly chest visual [Sonnet] - Procedural mesh with 16x16 wood/metal texture
[X] D-Pad input conflict resolved [Sonnet] - Removed D-Pad from movement, dedicated to building controls
[X] Item stacking system [Sonnet] - Stack limits enforced (wood: 100, stone: 50, food: 20, tools: 1)
[X] Stack count display [Sonnet] - Shows "current/max" format, red "FULL" indicator when maxed
[X] Inventory full notification [Sonnet] - On-screen alert when trying to exceed stack limits
[X] Inventory UI scene [Sonnet] - Created inventory_ui.tscn for proper rendering
[X] Code review [Opus] - Comprehensive codebase analysis (Grade: A)
[X] AI capacity planning documentation [Sonnet] - Created AI_USAGE_ANALYSIS.md with tracking templates
[X] DEVELOPMENT_GUIDE modernization [Sonnet] - Cleanup, encoding fixes, added technical debt section

Pre-v0.4.0 Features:
[X] Xbox controller support [Sonnet] - Full analog movement/camera, all buttons mapped
[X] Tool cycling improvement [Sonnet] - Removed "None" option, now only cycles Axe Ã¢â€ â€ Pickaxe
[X] Valheim-style log breaking physics [Sonnet] - Trees break into 3-5 log pieces on impact
[X] Impact-based tree shattering [Sonnet] - Logs spawn when fallen tree collides with terrain
[X] Log despawn particles [Sonnet] - Brown particle "poof" effects when logs disappear
[X] Removed tree stumps [Sonnet] - Clean world, better performance, avoids clutter issues
[X] Health/hunger system [Sonnet] - Stats management, regeneration when well-fed, eating from inventory
[X] Biome configuration system [Sonnet] - Inspector controls for biome size and vegetation densities
[X] Guaranteed Grassland spawn zone [Sonnet] - Valheim-style safe spawn with configurable radius
[X] Biome-specific vegetation distributions [Sonnet] - Each biome has unique tree types
[X] Code refactoring [Sonnet] - Extracted tree generators from vegetation_spawner
[X] Inventory UI [Sonnet] - Grid-based visual inventory (Tab to toggle), 32 slots
[X] Crafting system [Sonnet] - Recipe-based crafting with UI (Press R), 5 starter recipes
[X] Perlin noise cloud system [Sonnet] - Dual-layer noise for organic cloud shapes
[X] Enhanced crosshair [Sonnet] - Cross-shaped design with outline for visibility
[X] Sun/moon depth sorting fix [Sonnet] - Repositioned celestial bodies to z=Ã‚Â±500
[X] Tool system [Sonnet] - Axe/Pickaxe with requirement checking and visual feedback
[X] Procedural world generation [Sonnet] - Chunk-based terrain with FastNoiseLite
[X] Day/night cycle [Sonnet] - Time-based sky colors and celestial bodies
[X] Harvestable resources [Sonnet] - Trees, strawberries, mushrooms with proper collision
[X] Harvest particles [Sonnet] - Minecraft-style pixel "poof" effects when gathering
[X] Harvest UI feedback [Sonnet] - Progress bar and resource name display
[X] Tree falling physics [Sonnet] - Trees tip over when chopped down (Valheim-style)
[X] Resource night glow [Sonnet] - Mushrooms and strawberries emit light at night
[X] Critter spawning [Sonnet] - Rabbits, deer, birds, lizards, crabs with procedural placement
[X] Settings menu [Sonnet] - Resolution, fullscreen, vsync, MSAA, quality presets
[X] Water plane [Sonnet] - Infinite ocean with collision for walking
[X] Visual polish [Sonnet] - Clouds, crosshair, harvest highlights, tree physics


DESIGN QUESTIONS / DECISIONS NEEDED
------------------------------------
v0.5.0 Sprint Decisions (Made):
Ã¢Å“â€¦ Audio focus: Prioritize atmosphere over mechanics (audio > workbench)
Ã¢Å“â€¦ Music style: Pure ambient drone (meditative, cozy-lonely tone)
Ã¢Å“â€¦ Footsteps: Biome-aware (4 surfaces for immersion without complexity)
Ã¢Å“â€¦ Volume balance: Hybrid approach (realistic ambient, punchy actions)
Ã¢Å“â€¦ Budget: $34 investment for professional quality
Ã¢Å“â€¦ Music variety: Day/night variation (2 tracks, simple transition)

v0.4.0 Sprint Decisions (Made):
Ã¢Å“â€¦ Storage scope: Core + Polish approach (1 week timeline)
Ã¢Å“â€¦ Container UI: Click-to-transfer first, drag-and-drop later
Ã¢Å“â€¦ Container destruction: Harvestable (break to get materials back)
Ã¢Å“â€¦ Item stacking: Full implementation this sprint
Ã¢Å“â€¦ Workbench scope: Placement + proximity, defer recipe gating
Ã¢Å“â€¦ Release v0.4.0 with Priorities 1 & 2 complete (73% sprint completion)

Future Decisions (Still Open) - Use [Opus] for complex design decisions:
? Should tools degrade/break or have infinite durability? (affects resource loops) [Opus]
? What should unlock new biomes - boss kills or tool upgrades? (progression pacing) [Opus]
? Should building have structural integrity like Valheim or free placement like Minecraft? [Opus]
? How rare should character trees be? (currently 5% - too common or too rare?) [Sonnet]
? Should critters be harvestable for food/materials or purely ambient? [Sonnet]
? Should controller vibration intensity be configurable in settings? [Sonnet]
? Container limits: How many containers can exist in world simultaneously? [Sonnet]
? Should ambient music eventually adapt to gameplay intensity? [Sonnet]


TECHNICAL DEBT / REFACTORING
-----------------------------
[X] Code organization [Sonnet] - Extracted large tree generators into modular files (COMPLETE)

HIGH PRIORITY (from Opus 4.5 Code Review - 2025-12-11):
[ ] Critter visual extraction [Sonnet] - Extract critter visuals to separate files (rabbit_visual.gd, crab_visual.gd, etc.) following tree_visual.gd pattern. Reduces critter_spawner.gd from 1,143 lines.
[ ] ITEM_COLORS consolidation [Sonnet] - Move duplicated ITEM_COLORS dictionary from inventory_ui.gd and container_ui.gd to shared location (e.g., constants.gd or inventory.gd)
[ ] Container null safety [Sonnet] - Add container validity checks in container_ui.gd to prevent null reference if container is destroyed while UI is open

MEDIUM PRIORITY (from Code Review):
[ ] Input handling consolidation [Sonnet] - Consolidate duplicate input handling in player.gd. Use only Input Actions for maintainability.
[ ] Cloud system extraction [Sonnet] - Extract cloud system from day_night_cycle.gd (829 lines) to separate cloud_manager.gd
[ ] Debug output toggle [Sonnet] - Add debug flag to control print() statements throughout codebase

LOW PRIORITY:
[ ] Multi-material terrain system [Sonnet] - Replace vertex color tinting with proper material blending (chunk.gd)
[ ] Settings preset detection [Sonnet] - "Custom" preset detection could be more robust
[ ] Resource spawning optimization [Sonnet] - Could batch-spawn resources instead of one-at-a-time
[ ] Chunk unloading delay [Sonnet] - Add graceful fade-out before unloading distant chunks
[ ] Container slot pooling [Sonnet] - Reuse UI nodes instead of queue_free/recreate (performance optimization)
[ ] Block rotation [Sonnet] - Add ability to rotate walls/floors before placement in building system
[ ] LOD for distant trees [Sonnet] - Implement level-of-detail system for vegetation

QUARTERLY REVIEWS:
[ ] Architecture review [Opus] - Scheduled codebase health check (next: after save/load implementation)


BUGS / FIXES
------------
[X] Sun/moon seem to change sizes as I explore - FIXED [Sonnet]
[X] Crabs still don't seem to spawn - FIXED [Sonnet]
[X] Rocks are not glowing (blue-ish) at night - FIXED [Sonnet]
[X] Trees sometimes breaking too early before hitting ground - FIXED [Sonnet]
[X] Logs clipping through terrain - FIXED [Sonnet]
[X] Panels not centered in container UI - FIXED [Sonnet]
[X] Wrong panel order in container UI - FIXED [Sonnet]
[X] Other UIs visible when container open - FIXED [Sonnet]
[X] Inventory debug text showing during container interaction - FIXED [Sonnet]

POTENTIAL ISSUES (from Code Review - not yet confirmed):
[ ] Race condition [Sonnet] - Container destroyed while UI open could cause null reference
[ ] Input blocking too broad [Sonnet] - player.gd line 148 blocks ALL input when container open


SPRINT RISK ASSESSMENT (v0.5.0 - Current)
------------------------------------------
Ã°Å¸Å¸Â¢ LOW RISK: Audio system isolation - Won't break existing gameplay systems
   Mitigation: Audio manager is separate AutoLoad, no gameplay logic dependencies
   
Ã°Å¸Å¸Â¡ MEDIUM RISK: AI generation quality variance
   Mitigation: Use free tier for testing, upgrade only when satisfied with quality
   
Ã°Å¸Å¸Â¢ LOW RISK: Budget overrun ($34 target)
   Mitigation: SFX Engine is pay-per-credit (only buy what needed), Mubert is 1-month subscription
   
Ã°Å¸Å¸Â¢ LOW RISK: Integration complexity (many files to modify)
   Mitigation: Start with one system (harvesting), test, then expand to others
   
Ã°Å¸Å¸Â¡ MEDIUM RISK: Music looping seamlessness
   Mitigation: Test loops extensively, use Mubert's loop-friendly generation


SPRINT RISK ASSESSMENT (v0.4.0 - COMPLETED)
--------------------------------------------
Ã¢Å“â€¦ HIGH RISK: Container UI complexity (dual-panel, transfer logic) - MITIGATED (Phase 2 complete)
   Resolution: Scene-based architecture + click-to-transfer simplicity
   
Ã°Å¸Å¸Â¢ LOW RISK: Save compatibility for stacking changes
   Status: Design accommodates future save system
   
Ã°Å¸Å¸Â¢ LOW RISK: Controller UI navigation for containers
   Status: Mouse/keyboard working, controller support deferred
   
Ã¢Å“â€¦ LOW RISK: Feature creep - MITIGATED
   Resolution: Stuck to acceptance criteria, deferred extras to backlog


---
Notes:
- Project follows Valheim/Minecraft aesthetic: low-poly + 16x16 pixel textures
- Core loop: Explore Ã¢â€ â€™ Gather Ã¢â€ â€™ Craft Ã¢â€ â€™ Build Ã¢â€ â€™ Unlock new biomes Ã¢â€ â€™ Repeat
- Tone: Cozy loneliness with meditative gathering and discovery moments
- All features should support "one more trip" addictive gathering loop
- Full controller support implemented - keyboard+mouse and Xbox controller work simultaneously
- Sprint planning focuses on "Core + Polish" approach: deliver complete, polished features
- v0.4.0 Released: Storage Containers & Item Stacking (11/15 sprint tasks - 73% complete)
- v0.5.0 Current: Sound & Music System (12-15 sessions estimated, $34 budget)
- Code Review (Opus 4.5): Completed 2025-12-11 - Overall grade: A (Excellent)

AI MODEL USAGE SUMMARY:
- Total Opus tasks in backlog: ~12 (complex systems, architecture)
- Total Sonnet tasks in backlog: ~50+ (implementation, fixes, polish)
- v0.5.0 Sprint: 12-15 Sonnet sessions (~24-30% weekly capacity)
- Recommended weekly balance: 1 Opus session + 10-15 Sonnet sessions
- See AI_USAGE_ANALYSIS.md for detailed capacity planning
