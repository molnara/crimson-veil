CRIMSON VEIL - v0.6.0 IMPLEMENTATION GUIDE
==========================================

QUICK START CHECKLIST
=====================

PHASE 1: COMBAT FOUNDATION (Week 1)
------------------------------------
Day 1-2: Combat System Core
[ ] Create res://combat_system.gd
[ ] Create res://weapon.gd (Resource class)
[ ] Add input actions to project.godot (combat_attack, combat_dodge)
[ ] Integrate with player.gd input handling
[ ] Implement camera effects (shake, bob, recoil functions)

Day 3-4: Attack Mechanics
[ ] Light attack (raycast, damage, cooldown)
[ ] Charge attack (hold timer, 2x damage, effects)
[ ] Targeting system with soft auto-aim
[ ] Crosshair state system (default/targeting/charging/ready)
[ ] Charge vignette UI effect

Day 5: Dodge System
[ ] Dodge dash (velocity override, i-frames)
[ ] Context-sensitive A button logic
[ ] Controller integration (deadzone, stick input)
[ ] Cooldown tracking

Day 6: Weapons + Bow
[ ] Define 3 melee weapons (club/spear/sword)
[ ] Add crafting recipes
[ ] Bow charge mechanics
[ ] Hitscan arrow system
[ ] Arrow ammo tracking
[ ] Charge UI bar

PHASE 2: ENEMIES (Week 2)
--------------------------
Day 7-8: Enemy Base Class
[ ] Create res://enemy.gd (extends CharacterBody3D)
[ ] State machine (Idle/Chase/Attack/Death)
[ ] Health system
[ ] Drop table system
[ ] Flash effects (white/red)
[ ] Knockback system

Day 9-11: Enemy Types (2 per day)
[ ] Corrupted Rabbit (territorial, fast)
[ ] Forest Goblin (patrol, flee behavior)
[ ] Desert Scorpion (ambush, burrow)
[ ] Ice Wolf (pack AI, coordination)
[ ] Stone Golem (tank, ground slam)
[ ] Shadow Wraith (night-only, float, transparency shader)

Day 12: Spawning Integration
[ ] Extend critter_spawner.gd with enemy spawning
[ ] Biome-specific spawn logic
[ ] Pack spawning for Ice Wolves
[ ] Night-only logic for Shadow Wraith
[ ] Configure spawn rates

PHASE 3: AUDIO & VISUAL (Days 13-14)
-------------------------------------
Day 13: Audio Generation
[ ] Generate 32 sounds via SFX Engine
[ ] Import to res://audio/combat/
[ ] Configure AudioManager entries
[ ] Test all sound triggers

Day 14: Textures & Effects
[ ] Generate 5 textures via Leonardo.ai
[ ] Apply to enemy materials
[ ] Create hit particle effects
[ ] Polish visual feedback
[ ] Add rumble presets

PHASE 4: INTEGRATION & POLISH (Day 15)
---------------------------------------
Day 15: Final Integration
[ ] Death system (detection, UI, respawn)
[ ] Final rumble integration
[ ] Balance pass (damage numbers, HP)
[ ] Testing checklist
[ ] Bug fixes

FILE STRUCTURE
==============

New Files to Create:
--------------------
res://combat_system.gd              # Main combat logic
res://weapon.gd                      # Weapon resource class
res://enemy.gd                       # Base enemy class
res://enemies/
    â”œâ”€â”€ corrupted_rabbit.gd + .tscn
    â”œâ”€â”€ forest_goblin.gd + .tscn
    â”œâ”€â”€ desert_scorpion.gd + .tscn
    â”œâ”€â”€ ice_wolf.gd + .tscn
    â”œâ”€â”€ stone_golem.gd + .tscn
    â””â”€â”€ shadow_wraith.gd + .tscn
res://ui/death_screen.tscn + .gd    # Death/respawn UI
res://ui/combat_ui.gd               # Charge bar, button hints
res://audio/combat/                 # 32 combat sounds
res://textures/enemies/             # 5 AI-generated textures

Modified Files:
---------------
res://player.gd                     # Combat input integration
res://critter_spawner.gd            # Enemy spawning
res://health_hunger_system.gd       # Death detection
res://rumble_manager.gd             # Combat rumble presets
res://audio_manager.gd              # Combat sound entries
project.godot                       # Input action mappings

CRITICAL CODE SNIPPETS
======================

1. INPUT ACTIONS (project.godot)
---------------------------------
combat_attack={
    "events": [
        InputEventMouseButton (button_index=1),
        InputEventJoypadButton (button_index=7)  # RT
    ]
}

combat_dodge={
    "events": [
        InputEventKey (keycode=32),              # Space
        InputEventJoypadButton (button_index=0)  # A
    ]
}

2. COMBAT SYSTEM SKELETON
--------------------------
extends Node
class_name CombatSystem

var attack_cooldown: float = 0.0
var is_charging: bool = false
var charge_start_time: float = 0.0
var dodge_cooldown: float = 0.0

const CHARGE_THRESHOLD: float = 1.5
const DODGE_COOLDOWN: float = 3.0
const ATTACK_RANGE: float = 3.0

func start_charging():
    if attack_cooldown > 0: return
    is_charging = true
    charge_start_time = Time.get_ticks_msec() / 1000.0
    AudioManager.play_sound("charge_buildup", "sfx", false, true)

func release_attack():
    if not is_charging: return
    var charge_time = (Time.get_ticks_msec() / 1000.0) - charge_start_time
    is_charging = false
    AudioManager.stop_sound("charge_buildup")
    
    if charge_time >= CHARGE_THRESHOLD:
        perform_heavy_attack()
    else:
        perform_light_attack()

func try_dodge(input_dir: Vector2):
    if dodge_cooldown > 0: return
    # Implement dodge logic
    dodge_cooldown = DODGE_COOLDOWN

3. ENEMY BASE SKELETON
-----------------------
extends CharacterBody3D
class_name Enemy

enum State { IDLE, CHASE, ATTACK, DEATH }

@export var max_health: int = 50
@export var damage: int = 10
@export var move_speed: float = 3.0
@export var detection_range: float = 10.0
@export var attack_range: float = 2.0

var current_state: State = State.IDLE
var current_health: int
var player: Node3D

func _ready():
    current_health = max_health
    add_to_group("enemies")
    player = get_tree().get_first_node_in_group("player")
    create_enemy_visual()

func update_ai(delta: float):
    var distance = global_position.distance_to(player.global_position)
    match current_state:
        State.IDLE:
            if distance < detection_range:
                current_state = State.CHASE
        State.CHASE:
            if distance < attack_range:
                current_state = State.ATTACK
            else:
                chase_player()

func take_damage(amount: int, is_heavy: bool):
    current_health -= amount
    flash_white()
    if current_health <= 0:
        die()

4. BOW SYSTEM SKELETON
-----------------------
var is_drawing_bow: bool = false
var draw_start_time: float = 0.0
var arrow_count: int = 20

const MAX_DRAW_TIME: float = 2.0
const MIN_ARROW_DAMAGE: int = 15
const MAX_ARROW_DAMAGE: int = 40
const BOW_RANGE: float = 30.0

func start_drawing_bow():
    if arrow_count <= 0: return
    is_drawing_bow = true
    draw_start_time = Time.get_ticks_msec() / 1000.0
    AudioManager.play_sound("bow_draw", "sfx", false, true)

func release_arrow():
    if not is_drawing_bow: return
    var draw_time = (Time.get_ticks_msec() / 1000.0) - draw_start_time
    var draw_percent = clampf(draw_time / MAX_DRAW_TIME, 0.0, 1.0)
    is_drawing_bow = false
    AudioManager.stop_sound("bow_draw")
    
    var damage = int(lerp(MIN_ARROW_DAMAGE, MAX_ARROW_DAMAGE, draw_percent))
    var target = raycast_for_enemy(BOW_RANGE)
    if target:
        target.take_damage(damage, draw_percent >= 1.0)
        AudioManager.play_sound("arrow_hit_flesh", "sfx")
    
    arrow_count -= 1
    AudioManager.play_sound("bow_release", "sfx")

AI GENERATION COMMANDS
======================

AUDIO (SFX Engine):
-------------------
# Player Combat
"Quick weapon whoosh, sharp and fast, melee swing"
"Heavy powerful swing, deep whoosh with weight, charged attack"
"Rising energy hum, building tension, loopable, weapon charging"
"Satisfying ding, weapon fully charged indicator"
"Quick air whoosh, fast dash movement, dodge sound"
"Meaty impact, flesh hit, satisfying thud"
"Rock impact, stone breaking, hard surface hit"
"Player damage grunt, taking hit, short pain sound"

# Bow Sounds
"Bow drawing sound, wood creaking, tension building, loopable"
"Bow release twang, arrow firing, sharp snap"
"Arrow hit flesh, impact thud, projectile"
"Arrow hit wood, stick in surface, thunk"

# Enemy Sounds (example - Corrupted Rabbit)
"Corrupted animal growl, hostile, low menacing"
"Rabbit attack hiss, aggressive lunge"
"Rabbit damage squeak, small animal hurt"
"Rabbit death squeal, final sound, small creature"

TEXTURES (Leonardo.ai):
-----------------------
"Seamless tileable texture, corrupted animal fur, dark red-brown, diseased patches, matted, 512x512, top-down view, game texture"
"Seamless tileable texture, green goblin skin, mottled, warts, rough, fantasy game, 512x512, top-down view"
"Seamless tileable texture, scorpion chitin, sandy yellow, segmented plates, desert creature, 512x512, top-down view"
"Seamless tileable texture, white wolf fur, icy blue tint, frost patches, winter, 512x512, top-down view, game asset"
"Seamless tileable texture, granite stone, gray rock, orange glowing cracks, magma veins, 512x512, top-down view"

BALANCE REFERENCE
=================

PLAYER STATS:
Health: 100 HP
Move Speed: 5.0 m/s (walk), 10.0 m/s (sprint)
Dodge Distance: 4.0m (0.3s i-frames, 3s cooldown)

WEAPON DAMAGE TABLE:
Weapon          | Light | Heavy | Cooldown | Range
----------------|-------|-------|----------|-------
Wooden Club     |  15   |  30   |  1.0s    | 2.5m
Stone Spear     |  20   |  40   |  1.2s    | 3.5m
Bone Sword      |  25   |  50   |  1.0s    | 3.0m
Bow (min)       |  15   |  -    |  0.5s    | 30m
Bow (max)       |  40   |  -    |  2.0s    | 30m

ENEMY STATS TABLE:
Enemy            | HP  | DMG | Speed | Range | Hits to Kill (Club Light/Heavy)
-----------------|-----|-----|-------|-------|--------------------------------
Corrupted Rabbit | 30  |  8  | 4.5   | 1.5m  | 2 / 1
Forest Goblin    | 50  | 12  | 3.0   | 2.0m  | 4 / 2
Desert Scorpion  | 60  | 15  | 3.0   | 2.5m  | 4 / 2
Ice Wolf         | 55  | 14  | 4.5   | 2.0m  | 4 / 2
Stone Golem      | 100 | 20  | 1.5   | 2.5m  | 7 / 4
Shadow Wraith    | 40  | 12  | 4.0   | 2.0m  | 3 / 2

SPAWN RATES (per chunk):
Corrupted Rabbit: 15% (Forest)
Forest Goblin: 8% (Forest)
Desert Scorpion: 12% (Desert)
Ice Wolf: 10% (Snow, spawns in packs of 2-3)
Stone Golem: 5% (Mountains)
Shadow Wraith: 8% (All biomes, night only)

TESTING PROTOCOL
================

PRE-COMMIT CHECKLIST:
[ ] All 12 tasks completed
[ ] 32 sounds generated and integrated
[ ] 5 textures generated and applied
[ ] All 6 enemies spawn and function
[ ] Combat works with M+KB
[ ] Combat works with controller
[ ] Death/respawn works
[ ] No game-breaking bugs
[ ] Performance acceptable (60 FPS with 6+ enemies)

MINIMUM VIABLE RELEASE:
[ ] Can attack and kill at least 1 enemy type
[ ] Bow works (charge, fire, ammo)
[ ] Death screen appears
[ ] Respawn works
[ ] Basic audio/rumble integrated

NICE TO HAVE (v0.6.1):
[ ] All 6 enemy types polished
[ ] Damage numbers
[ ] Enemy ambient sounds
[ ] Critical hits
[ ] Full texture set

COMMON PITFALLS
===============

1. ATTACK COOLDOWN SPAM
   Fix: Always check cooldown before allowing attack
   
2. DODGE WHILE CHARGING
   Fix: Decide if charging can be cancelled (recommend: yes)
   
3. ENEMY STUCK IN WALLS
   Fix: Set collision_mask properly (Layer 1 only)
   
4. CONTROLLER AUTO-AIM TOO STRONG
   Fix: Tune cone angle (start at 30Â°, reduce if needed)
   
5. ARROW AMMO CONFUSION
   Fix: Show arrow count in UI clearly
   
6. SHADOW WRAITH SPAWNS AT DAY
   Fix: Check time_of_day properly (>= 0.9167 or < 0.25)
   
7. ICE WOLVES DON'T PACK
   Fix: form_pack() called deferred in _ready()
   
8. STONE GOLEM TOO HARD
   Fix: Reduce HP to 80 or increase player damage
   
9. SOUNDS NOT PLAYING
   Fix: Check AudioManager.play_sound() category parameter
   
10. CHARGE BAR NOT VISIBLE ON CONTROLLER
    Fix: Enable charge_bar UI when controller detected

PERFORMANCE TARGETS
===================

Target FPS: 60 (minimum)
Max Active Enemies: 12 simultaneously
Draw Calls: <100 with enemies
Memory: <500 MB
Load Time: <2 seconds

If performance issues:
1. Reduce enemy spawn rates
2. Use simpler particle effects
3. Lower texture resolution (256x256)
4. Cull distant enemies
5. Reduce max active enemies to 8

RELEASE CRITERIA
================

MUST HAVE:
âœ“ Combat system functional (attack, charge, dodge)
âœ“ At least 3 enemy types working
âœ“ Bow functional with ammo
âœ“ Death/respawn working
âœ“ Controller support complete
âœ“ No crashes or soft-locks
âœ“ Audio playing correctly

SHOULD HAVE:
âœ“ All 6 enemy types
âœ“ All textures applied
âœ“ All sounds integrated
âœ“ Rumble working
âœ“ Visual effects polished

NICE TO HAVE:
â—‹ Damage numbers
â—‹ Critical hits
â—‹ Enemy ambient sounds
â—‹ Weapon durability

VERSION NUMBERING
=================

v0.6.0 - Initial combat release
v0.6.1 - Bug fixes + polish
v0.6.2 - Balance adjustments
v0.7.0 - Next major feature (bosses/save system)

SUPPORT RESOURCES
=================

Godot Docs: https://docs.godotengine.org/en/stable/
CharacterBody3D: https://docs.godotengine.org/en/stable/classes/class_characterbody3d.html
State Machines: https://gdquest.com/tutorial/godot/design-patterns/finite-state-machine/
Rumble API: https://docs.godotengine.org/en/stable/classes/class_input.html#class-input-method-start-joy-vibration

Discord: [Your game dev community]
GitHub: [Your repo]

GOOD LUCK! ðŸŽ®âš”ï¸
